;; gorilla-repl.fileformat = 1

;; **
;;; # Conway's Game of Life
;;; 
;;; Have you ever attended a [Code Retreat](http://coderetreat.org/)? Then you might know that Conway's Game of Life is a little bit tricky - it seems easy, but is actually hard to do in 45 minutes, reserved for one session. After all, this was the reason the Game of Life was chosen for Code Retreat:) But Clojure ruined it all. Be warned - after going through this worksheet, Code Retreat will never be the same again!
;;; 
;;; For those not familiar with [Game of Life](http://coderetreat.org/gol), it is a "zero-player game", or rather an algorithm, that evolves an initial 2D grid of cells according to the four rules. At each step in time, the following transitions occur:
;;; 
;;; * Any live cell with fewer than two live neighbours dies, as if caused by underpopulation.
;;; * Any live cell with more than three live neighbours dies, as if by overcrowding.
;;; * Any live cell with two or three live neighbours lives on to the next generation.
;;; * Any dead cell with exactly three live neighbours becomes a live cell.
;;; 
;;; There are interesting patterns of moving and still-life [patterns](http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life#Examples_of_patterns), and one of them - [the Glider](http://en.wikipedia.org/wiki/Glider_%28Conway%27s_Life%29#Hacker_emblem) - was even proposed as an emblem to represent the hacker subculture.
;;; 
;;; <img src="http://upload.wikimedia.org/wikipedia/commons/9/96/Animated_glider_emblem.gif">
;; **

;; **
;;; ## Game of Life in Clojure
;;; 
;;; Typical implementation in object-oriented languages (as seen at Code Retreats) involve definition of the Cell class, overriding equals and hashCode methods. Then something like Board class and finding all neighbouring cells. If the 45-minutes session is not already over, another goal is to find all neighbouring cell for each cell and determine whether it should survive. And then comes the hard part of this approach - finding dead cells that should become alive.
;;; 
;;; It's truly impossible to fit this in 45 minutes; yet the complete algorithm in Clojure takes only few minutes. How is it possible?
;;; 
;;; It is a combination of two things: A clever algorithm and the powerful language.
;;; 
;;; So let's start hacking the joyful Game of Life in Clojure!
;; **

;; **
;;; ## Inspiration
;;; 
;;; This is just another form of the algorithm that was published here: http://clj-me.cgrand.net/2011/08/19/conways-game-of-life/
;; **

;; **
;;; ## Namespace and Imports
;;; 
;;; First, we declare the namespace for this piece of code and import some plotting functions that allows to visualise the grid.
;; **

;; @@
(ns joyful-game.worksheet
  (:require [gorilla-plot.core :as plot]
            [joyful-game.gorilla :as g]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; ## The Data Structure
;;; 
;;; The grid of cells can be represented in various ways. The simplest and most convenient is a vector containing [x y] coordinates. Each coordinate represents a living cell.
;; **

;; @@
; board containing three living cells
(def board #{[1 1] [2 0] [3 1]})
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;joyful-game.worksheet/board</span>","value":"#'joyful-game.worksheet/board"}
;; <=

;; @@
(g/plot-cells board)
;; @@
;; ->
;;; 5 3
;; <-
;; =>
;;; {"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,5]},{"name":"y","range":"height","domain":[-1,3],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[-1,0,1,2],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"5a11c1d3-286f-4b6c-8bf6-4b1427dd6aad"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"5a11c1d3-286f-4b6c-8bf6-4b1427dd6aad"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"5a11c1d3-286f-4b6c-8bf6-4b1427dd6aad","values":[{"x":1,"x2":2,"y":1,"y2":2,"text":null,"opacity":1},{"x":2,"x2":3,"y":0,"y2":1,"text":null,"opacity":1},{"x":3,"x2":4,"y":1,"y2":2,"text":null,"opacity":1}]}],"width":150,"height":120},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [-1 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (-1 0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"5a11c1d3-286f-4b6c-8bf6-4b1427dd6aad\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"5a11c1d3-286f-4b6c-8bf6-4b1427dd6aad\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"5a11c1d3-286f-4b6c-8bf6-4b1427dd6aad\", :values ({:x 1, :x2 2, :y 1, :y2 2, :text nil, :opacity 1} {:x 2, :x2 3, :y 0, :y2 1, :text nil, :opacity 1} {:x 3, :x2 4, :y 1, :y2 2, :text nil, :opacity 1})}], :width 150, :height 120}}"}
;; <=

;; **
;;; ## Finding the Neighbours
;;; 
;;; Then we define one handy function, that will return all possible neighbours for a given cell.
;; **

;; @@
(defn neighbours [[x y]] ; parameter cell is destructured into x and y
  (for [dx [-1 0 1] dy [-1 0 1] ; for all combinations of dx and dy...
        :when (not (= dx 0 dy))] ; ...except when dx = 0 = dy...
    [(+ x dx) (+ y dy)])) ; ...add dx to x and dy to y

; let's try it out
(neighbours [1 2])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[0 1]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[0 2]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[0 3]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[1 1]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[1 3]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[2 1]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[2 2]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[2 3]"}],"value":"([0 1] [0 2] [0 3] [1 1] [1 3] [2 1] [2 2] [2 3])"}
;; <=

;; **
;;; ## Counting Living Neighbours
;;; 
;;; Naive solution is to loop through all the living cells, find all it's neighbours and then count it. It would work fine for living cells, but what about dead cells, that should become alive when they have exactly three neighbours? We should loop through all neighbouring dead cells of each living cell and count their neighbours too.
;;; 
;;; But there is a more elegant solution. What if we simply produce a list of all neighbours for each living cell and concat it to one huge list? When some cell occurs twice in such list, it means it has two neighbours.
;;; 
;;; Clojure has a function for counting items in list: frequencies
;; **

;; @@
(frequencies [:a :b :b :b :c :c])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:a</span>","value":":a"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:a 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:b</span>","value":":b"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[:b 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:c</span>","value":":c"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[:c 2]"}],"value":"{:a 1, :b 3, :c 2}"}
;; <=

;; @@
(frequencies [[0 0] [1 2] [2 3] [1 2]])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[0 0]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 0] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[1 2]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[1 2] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[2 3]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[2 3] 1]"}],"value":"{[0 0] 1, [1 2] 2, [2 3] 1}"}
;; <=

;; **
;;; So let's try to take a board defined earlier, produce list of neighbours for each cell, concat it into one list and count frequencies:
;; **

;; @@
(frequencies (mapcat neighbours board)) ; mapcat is map + concat
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[2 2]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[2 2] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[0 0]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 0] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>-1</span>","value":"-1"}],"value":"[2 -1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[2 -1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[1 0]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[1 0] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[1 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[1 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[4 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[4 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[3 0]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[3 0] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>-1</span>","value":"-1"}],"value":"[3 -1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[3 -1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[4 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[4 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>-1</span>","value":"-1"}],"value":"[1 -1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[1 -1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[0 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[2 0]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[2 0] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[3 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[3 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[2 1]"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[[2 1] 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[1 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[1 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[3 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[3 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[0 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[4 0]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[4 0] 1]"}],"value":"{[2 2] 2, [0 0] 1, [2 -1] 1, [1 0] 2, [1 1] 1, [4 2] 1, [3 0] 2, [3 -1] 1, [4 1] 1, [1 -1] 1, [0 2] 1, [2 0] 2, [3 1] 1, [2 1] 3, [1 2] 1, [3 2] 1, [0 1] 1, [4 0] 1}"}
;; <=

;; **
;;; Let's visualize the original cells together with frequencies of their neighbours. Notice that the number corresponds to the number of living neighbours!
;; **

;; @@
(plot/compose 
	(g/plot-cells board)
	(g/plot-frequencies (frequencies (mapcat neighbours board)) :opacity 0.2))
;; @@
;; ->
;;; 5 36 4
;; <-
;; =>
;;; {"type":"vega","content":{"width":150,"height":120,"padding":null,"scales":[{"name":"x","range":"width","domain":[0,5]},{"name":"y","range":"height","domain":[-1,3],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[-1,0,1,2],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"data":[{"name":"2f634381-062e-4dd0-9b48-31a58a414120","values":[{"x":1,"x2":2,"y":1,"y2":2,"text":null,"opacity":1},{"x":2,"x2":3,"y":0,"y2":1,"text":null,"opacity":1},{"x":3,"x2":4,"y":1,"y2":2,"text":null,"opacity":1}]},{"name":"51619fae-6fa1-46c4-bd04-fcef7ca081e8","values":[{"x":2,"x2":3,"y":2,"y2":3,"text":2,"opacity":0.4},{"x":0,"x2":1,"y":0,"y2":1,"text":1,"opacity":0.2},{"x":2,"x2":3,"y":-1,"y2":0,"text":1,"opacity":0.2},{"x":1,"x2":2,"y":0,"y2":1,"text":2,"opacity":0.4},{"x":1,"x2":2,"y":1,"y2":2,"text":1,"opacity":0.2},{"x":4,"x2":5,"y":2,"y2":3,"text":1,"opacity":0.2},{"x":3,"x2":4,"y":0,"y2":1,"text":2,"opacity":0.4},{"x":3,"x2":4,"y":-1,"y2":0,"text":1,"opacity":0.2},{"x":4,"x2":5,"y":1,"y2":2,"text":1,"opacity":0.2},{"x":1,"x2":2,"y":-1,"y2":0,"text":1,"opacity":0.2},{"x":0,"x2":1,"y":2,"y2":3,"text":1,"opacity":0.2},{"x":2,"x2":3,"y":0,"y2":1,"text":2,"opacity":0.4},{"x":3,"x2":4,"y":1,"y2":2,"text":1,"opacity":0.2},{"x":2,"x2":3,"y":1,"y2":2,"text":3,"opacity":0.6000000000000001},{"x":1,"x2":2,"y":2,"y2":3,"text":1,"opacity":0.2},{"x":3,"x2":4,"y":2,"y2":3,"text":1,"opacity":0.2},{"x":0,"x2":1,"y":1,"y2":2,"text":1,"opacity":0.2},{"x":4,"x2":5,"y":0,"y2":1,"text":1,"opacity":0.2}]}],"marks":[{"type":"rect","from":{"data":"2f634381-062e-4dd0-9b48-31a58a414120"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"2f634381-062e-4dd0-9b48-31a58a414120"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}},{"type":"rect","from":{"data":"51619fae-6fa1-46c4-bd04-fcef7ca081e8"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"green"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"51619fae-6fa1-46c4-bd04-fcef7ca081e8"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 150, :height 120, :padding nil, :scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [-1 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (-1 0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :data ({:name \"2f634381-062e-4dd0-9b48-31a58a414120\", :values ({:x 1, :x2 2, :y 1, :y2 2, :text nil, :opacity 1} {:x 2, :x2 3, :y 0, :y2 1, :text nil, :opacity 1} {:x 3, :x2 4, :y 1, :y2 2, :text nil, :opacity 1})} {:name \"51619fae-6fa1-46c4-bd04-fcef7ca081e8\", :values ({:x 2, :x2 3, :y 2, :y2 3, :text 2, :opacity 0.4} {:x 0, :x2 1, :y 0, :y2 1, :text 1, :opacity 0.2} {:x 2, :x2 3, :y -1, :y2 0, :text 1, :opacity 0.2} {:x 1, :x2 2, :y 0, :y2 1, :text 2, :opacity 0.4} {:x 1, :x2 2, :y 1, :y2 2, :text 1, :opacity 0.2} {:x 4, :x2 5, :y 2, :y2 3, :text 1, :opacity 0.2} {:x 3, :x2 4, :y 0, :y2 1, :text 2, :opacity 0.4} {:x 3, :x2 4, :y -1, :y2 0, :text 1, :opacity 0.2} {:x 4, :x2 5, :y 1, :y2 2, :text 1, :opacity 0.2} {:x 1, :x2 2, :y -1, :y2 0, :text 1, :opacity 0.2} {:x 0, :x2 1, :y 2, :y2 3, :text 1, :opacity 0.2} {:x 2, :x2 3, :y 0, :y2 1, :text 2, :opacity 0.4} {:x 3, :x2 4, :y 1, :y2 2, :text 1, :opacity 0.2} {:x 2, :x2 3, :y 1, :y2 2, :text 3, :opacity 0.6000000000000001} {:x 1, :x2 2, :y 2, :y2 3, :text 1, :opacity 0.2} {:x 3, :x2 4, :y 2, :y2 3, :text 1, :opacity 0.2} {:x 0, :x2 1, :y 1, :y2 2, :text 1, :opacity 0.2} {:x 4, :x2 5, :y 0, :y2 1, :text 1, :opacity 0.2})}), :marks ({:type \"rect\", :from {:data \"2f634381-062e-4dd0-9b48-31a58a414120\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"2f634381-062e-4dd0-9b48-31a58a414120\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}} {:type \"rect\", :from {:data \"51619fae-6fa1-46c4-bd04-fcef7ca081e8\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"green\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"51619fae-6fa1-46c4-bd04-fcef7ca081e8\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}})}}"}
;; <=

;; **
;;; ## Who Should Survive?
;;; 
;;; Now we have to decide, which cells should live in the next generation. According to the rules of the game, cell will be alive in the next step if at least one of the following statements is true:
;;; 
;;; * Cell has 3 neighbours
;;; * Cell has 2 neighbours and is alive
;;; 
;;; We can formalize it as a function:
;; **

;; @@
(defn should-be-alive? [is-alive neighbours]
  (or (= neighbours 3)
      (and (= neighbours 2) is-alive)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;joyful-game.worksheet/should-be-alive?</span>","value":"#'joyful-game.worksheet/should-be-alive?"}
;; <=

;; @@
(should-be-alive? true 2)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>true</span>","value":"true"}
;; <=

;; @@
(should-be-alive? false 3)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>true</span>","value":"true"}
;; <=

;; @@
(should-be-alive? false 2)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>false</span>","value":"false"}
;; <=

;; **
;;; ## Time to put it All Together
;;; 
;;; Now we have all the pieces we need to write a function that takes a board and returns a new version of the board. But first we have to learn two tricks:
;; **

;; @@
; ->> is "thread-last" macro: it takes a thing and inserts it as a last argument of the next function, e.g.:
(->> board ; take the board
     (mapcat neighbours) ; map it using function neighbours and concat results
     frequencies) ; compute frequencies of neighbours
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[2 2]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[2 2] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[0 0]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 0] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>-1</span>","value":"-1"}],"value":"[2 -1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[2 -1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[1 0]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[1 0] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[1 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[1 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[4 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[4 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[3 0]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[3 0] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>-1</span>","value":"-1"}],"value":"[3 -1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[3 -1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[4 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[4 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>-1</span>","value":"-1"}],"value":"[1 -1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[1 -1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[0 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[2 0]"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[[2 0] 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[3 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[3 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[2 1]"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[[2 1] 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[1 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[1 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"}],"value":"[3 2]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[3 2] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[0 1]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[0 1] 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[4 0]"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[[4 0] 1]"}],"value":"{[2 2] 2, [0 0] 1, [2 -1] 1, [1 0] 2, [1 1] 1, [4 2] 1, [3 0] 2, [3 -1] 1, [4 1] 1, [1 -1] 1, [0 2] 1, [2 0] 2, [3 1] 1, [2 1] 3, [1 2] 1, [3 2] 1, [0 1] 1, [4 0] 1}"}
;; <=

;; @@
; set itself can be used as function, it is an idiom to determine whether a set contains an item
(#{1 2 3 4} 3) ; returns item, if found
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}
;; <=

;; @@
(#{1 2 3 4} 333) ; returns nil if not found 
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
; it is commonly used as a logical expression in a condition:
(if (#{:a :b :c} :b)
  (println "Yes!")
  (println "noo"))
;; @@
;; ->
;;; Yes!
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; Finally, we can write the Game-of-Life function:
;; **

;; @@
(defn step [board]
  "Takes a board and returns it's new version, after one step of Game-of-Life" ; documentation
  (->> board
       (mapcat neighbours)
       frequencies
       (filter (fn [[cell frq]] (should-be-alive? (board cell) frq)))
       (map first) ; transform [[x y] freq] to [x y]
       set)) ; convert the result into set
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;joyful-game.worksheet/step</span>","value":"#'joyful-game.worksheet/step"}
;; <=

;; @@
(step board)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-set'>#{</span>","close":"<span class='clj-set'>}</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[2 0]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[2 1]"}],"value":"#{[2 0] [2 1]}"}
;; <=

;; @@
(->> (iterate step board)
     (take 3)
     (map g/plot-cells))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,5]},{"name":"y","range":"height","domain":[-1,3],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[-1,0,1,2],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"4e24ca7f-d116-4df5-baad-355ff63efc99"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"4e24ca7f-d116-4df5-baad-355ff63efc99"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"4e24ca7f-d116-4df5-baad-355ff63efc99","values":[{"x":1,"x2":2,"y":1,"y2":2,"text":null,"opacity":1},{"x":2,"x2":3,"y":0,"y2":1,"text":null,"opacity":1},{"x":3,"x2":4,"y":1,"y2":2,"text":null,"opacity":1}]}],"width":150,"height":120},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [-1 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (-1 0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"4e24ca7f-d116-4df5-baad-355ff63efc99\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"4e24ca7f-d116-4df5-baad-355ff63efc99\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"4e24ca7f-d116-4df5-baad-355ff63efc99\", :values ({:x 1, :x2 2, :y 1, :y2 2, :text nil, :opacity 1} {:x 2, :x2 3, :y 0, :y2 1, :text nil, :opacity 1} {:x 3, :x2 4, :y 1, :y2 2, :text nil, :opacity 1})}], :width 150, :height 120}}"},{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,4]},{"name":"y","range":"height","domain":[-1,3],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[-1,0,1,2],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"978241b7-a7cd-4653-b920-da50253f2ae0"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"978241b7-a7cd-4653-b920-da50253f2ae0"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"978241b7-a7cd-4653-b920-da50253f2ae0","values":[{"x":2,"x2":3,"y":0,"y2":1,"text":null,"opacity":1},{"x":2,"x2":3,"y":1,"y2":2,"text":null,"opacity":1}]}],"width":120,"height":120},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 4]} {:name \"y\", :range \"height\", :domain [-1 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (-1 0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"978241b7-a7cd-4653-b920-da50253f2ae0\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"978241b7-a7cd-4653-b920-da50253f2ae0\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"978241b7-a7cd-4653-b920-da50253f2ae0\", :values ({:x 2, :x2 3, :y 0, :y2 1, :text nil, :opacity 1} {:x 2, :x2 3, :y 1, :y2 2, :text nil, :opacity 1})}], :width 120, :height 120}}"},{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,3]},{"name":"y","range":"height","domain":[0,3],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[0,1,2],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1","values":[]}],"width":90,"height":90},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 3]} {:name \"y\", :range \"height\", :domain [0 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1\", :values ()}], :width 90, :height 90}}"}],"value":"(5 34 3#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [-1 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (-1 0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"4e24ca7f-d116-4df5-baad-355ff63efc99\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"4e24ca7f-d116-4df5-baad-355ff63efc99\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"4e24ca7f-d116-4df5-baad-355ff63efc99\", :values ({:x 1, :x2 2, :y 1, :y2 2, :text nil, :opacity 1} {:x 2, :x2 3, :y 0, :y2 1, :text nil, :opacity 1} {:x 3, :x2 4, :y 1, :y2 2, :text nil, :opacity 1})}], :width 150, :height 120}} 3 3#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 4]} {:name \"y\", :range \"height\", :domain [-1 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (-1 0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"978241b7-a7cd-4653-b920-da50253f2ae0\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"978241b7-a7cd-4653-b920-da50253f2ae0\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"978241b7-a7cd-4653-b920-da50253f2ae0\", :values ({:x 2, :x2 3, :y 0, :y2 1, :text nil, :opacity 1} {:x 2, :x2 3, :y 1, :y2 2, :text nil, :opacity 1})}], :width 120, :height 120}} #gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 3]} {:name \"y\", :range \"height\", :domain [0 3], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"0a08f3e6-aaf1-4d93-aba6-d4e9077df0e1\", :values ()}], :width 90, :height 90}})"}
;; <=

;; @@
(conj #{[1 1]} [1 1])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-set'>#{</span>","close":"<span class='clj-set'>}</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[1 1]"}],"value":"#{[1 1]}"}
;; <=

;; **
;;; We can visualize the succession of steps of the Glider pattern, shown in the beginning of this post:
;; **

;; @@
(def glider #{[1 3] [2 3] [3 3] [3 2] [2 1]})

(->> (iterate step glider)
     (take 5)
     (map g/plot-cells))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,5]},{"name":"y","range":"height","domain":[0,5],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[0,1,2,3,4],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"def06f56-d29a-456c-8b8e-f5a93803bae9"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"def06f56-d29a-456c-8b8e-f5a93803bae9"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"def06f56-d29a-456c-8b8e-f5a93803bae9","values":[{"x":2,"x2":3,"y":3,"y2":4,"text":null,"opacity":1},{"x":3,"x2":4,"y":3,"y2":4,"text":null,"opacity":1},{"x":1,"x2":2,"y":3,"y2":4,"text":null,"opacity":1},{"x":2,"x2":3,"y":1,"y2":2,"text":null,"opacity":1},{"x":3,"x2":4,"y":2,"y2":3,"text":null,"opacity":1}]}],"width":150,"height":150},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [0 5], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"def06f56-d29a-456c-8b8e-f5a93803bae9\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"def06f56-d29a-456c-8b8e-f5a93803bae9\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"def06f56-d29a-456c-8b8e-f5a93803bae9\", :values ({:x 2, :x2 3, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 1, :x2 2, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 1, :y2 2, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 150, :height 150}}"},{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,5]},{"name":"y","range":"height","domain":[0,6],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[0,1,2,3,4,5],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"63f69ab5-7da9-44a4-b0b0-866917f6055c"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"63f69ab5-7da9-44a4-b0b0-866917f6055c"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"63f69ab5-7da9-44a4-b0b0-866917f6055c","values":[{"x":2,"x2":3,"y":3,"y2":4,"text":null,"opacity":1},{"x":3,"x2":4,"y":3,"y2":4,"text":null,"opacity":1},{"x":2,"x2":3,"y":4,"y2":5,"text":null,"opacity":1},{"x":1,"x2":2,"y":2,"y2":3,"text":null,"opacity":1},{"x":3,"x2":4,"y":2,"y2":3,"text":null,"opacity":1}]}],"width":150,"height":180},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"63f69ab5-7da9-44a4-b0b0-866917f6055c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"63f69ab5-7da9-44a4-b0b0-866917f6055c\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"63f69ab5-7da9-44a4-b0b0-866917f6055c\", :values ({:x 2, :x2 3, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1} {:x 1, :x2 2, :y 2, :y2 3, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 150, :height 180}}"},{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,5]},{"name":"y","range":"height","domain":[0,6],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[0,1,2,3,4,5],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"23d17c24-96b2-4920-a4fa-dd07dc863535"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"23d17c24-96b2-4920-a4fa-dd07dc863535"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"23d17c24-96b2-4920-a4fa-dd07dc863535","values":[{"x":3,"x2":4,"y":3,"y2":4,"text":null,"opacity":1},{"x":3,"x2":4,"y":4,"y2":5,"text":null,"opacity":1},{"x":1,"x2":2,"y":3,"y2":4,"text":null,"opacity":1},{"x":2,"x2":3,"y":4,"y2":5,"text":null,"opacity":1},{"x":3,"x2":4,"y":2,"y2":3,"text":null,"opacity":1}]}],"width":150,"height":180},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"23d17c24-96b2-4920-a4fa-dd07dc863535\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"23d17c24-96b2-4920-a4fa-dd07dc863535\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"23d17c24-96b2-4920-a4fa-dd07dc863535\", :values ({:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 4, :y2 5, :text nil, :opacity 1} {:x 1, :x2 2, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 150, :height 180}}"},{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,6]},{"name":"y","range":"height","domain":[0,6],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4,5],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[0,1,2,3,4,5],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"efc0d2c8-739a-4324-984e-4a5473038113"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"efc0d2c8-739a-4324-984e-4a5473038113"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"efc0d2c8-739a-4324-984e-4a5473038113","values":[{"x":4,"x2":5,"y":3,"y2":4,"text":null,"opacity":1},{"x":2,"x2":3,"y":2,"y2":3,"text":null,"opacity":1},{"x":3,"x2":4,"y":3,"y2":4,"text":null,"opacity":1},{"x":3,"x2":4,"y":4,"y2":5,"text":null,"opacity":1},{"x":2,"x2":3,"y":4,"y2":5,"text":null,"opacity":1}]}],"width":180,"height":180},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 6]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"efc0d2c8-739a-4324-984e-4a5473038113\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"efc0d2c8-739a-4324-984e-4a5473038113\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"efc0d2c8-739a-4324-984e-4a5473038113\", :values ({:x 4, :x2 5, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 2, :y2 3, :text nil, :opacity 1} {:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 4, :y2 5, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1})}], :width 180, :height 180}}"},{"type":"vega","content":{"scales":[{"name":"x","range":"width","domain":[0,6]},{"name":"y","range":"height","domain":[0,6],"reverse":true}],"axes":[{"type":"x","scale":"x","ticks":"nice","values":[0,1,2,3,4,5],"grid":true,"orient":"top","properties":{"labels":{"x":{"scale":"x","offset":15}}}},{"type":"y","scale":"y","ticks":"nice","values":[0,1,2,3,4,5],"grid":true,"properties":{"labels":{"y":{"scale":"y","offset":15}}}},{"scale":"y","type":"y","orient":"right","ticks":0},{"scale":"x","type":"x","orient":"bottom","ticks":0},{"scale":"x","type":"x","orient":"top","ticks":0}],"marks":[{"type":"rect","from":{"data":"95d67d4a-743f-44fc-9008-48578de38d3f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"x2":{"scale":"x","field":"data.x2"},"y":{"scale":"y","field":"data.y"},"y2":{"scale":"y","field":"data.y2"},"fill":{"value":"red"},"fillOpacity":{"field":"data.opacity"}}}},{"type":"text","from":{"data":"95d67d4a-743f-44fc-9008-48578de38d3f"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"baseline":{"value":"middle"},"align":{"value":"center"},"fill":{"value":"black"},"width":{"value":29},"dy":{"value":15},"x":{"scale":"x","field":"data.x","offset":15},"fontSize":{"value":18.0},"text":{"field":"data.text"}}}}],"data":[{"name":"95d67d4a-743f-44fc-9008-48578de38d3f","values":[{"x":4,"x2":5,"y":3,"y2":4,"text":null,"opacity":1},{"x":3,"x2":4,"y":4,"y2":5,"text":null,"opacity":1},{"x":2,"x2":3,"y":4,"y2":5,"text":null,"opacity":1},{"x":4,"x2":5,"y":4,"y2":5,"text":null,"opacity":1},{"x":3,"x2":4,"y":2,"y2":3,"text":null,"opacity":1}]}],"width":180,"height":180},"value":"#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 6]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"95d67d4a-743f-44fc-9008-48578de38d3f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"95d67d4a-743f-44fc-9008-48578de38d3f\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"95d67d4a-743f-44fc-9008-48578de38d3f\", :values ({:x 4, :x2 5, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 4, :y2 5, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1} {:x 4, :x2 5, :y 4, :y2 5, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 180, :height 180}}"}],"value":"(5 55 6#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [0 5], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"def06f56-d29a-456c-8b8e-f5a93803bae9\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"def06f56-d29a-456c-8b8e-f5a93803bae9\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"def06f56-d29a-456c-8b8e-f5a93803bae9\", :values ({:x 2, :x2 3, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 1, :x2 2, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 1, :y2 2, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 150, :height 150}} 5 6#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"63f69ab5-7da9-44a4-b0b0-866917f6055c\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"63f69ab5-7da9-44a4-b0b0-866917f6055c\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"63f69ab5-7da9-44a4-b0b0-866917f6055c\", :values ({:x 2, :x2 3, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1} {:x 1, :x2 2, :y 2, :y2 3, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 150, :height 180}} 6 6#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 5]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"23d17c24-96b2-4920-a4fa-dd07dc863535\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"23d17c24-96b2-4920-a4fa-dd07dc863535\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"23d17c24-96b2-4920-a4fa-dd07dc863535\", :values ({:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 4, :y2 5, :text nil, :opacity 1} {:x 1, :x2 2, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 150, :height 180}} 6 6#gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 6]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"efc0d2c8-739a-4324-984e-4a5473038113\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"efc0d2c8-739a-4324-984e-4a5473038113\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"efc0d2c8-739a-4324-984e-4a5473038113\", :values ({:x 4, :x2 5, :y 3, :y2 4, :text nil, :opacity 1} {:x 2, :x2 3, :y 2, :y2 3, :text nil, :opacity 1} {:x 3, :x2 4, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 4, :y2 5, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1})}], :width 180, :height 180}} #gorilla_repl.vega.VegaView{:content {:scales [{:name \"x\", :range \"width\", :domain [0 6]} {:name \"y\", :range \"height\", :domain [0 6], :reverse true}], :axes [{:type \"x\", :scale \"x\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :orient \"top\", :properties {:labels {:x {:scale \"x\", :offset 15}}}} {:type \"y\", :scale \"y\", :ticks \"nice\", :values (0 1 2 3 4 5), :grid true, :properties {:labels {:y {:scale \"y\", :offset 15}}}} {:scale \"y\", :type \"y\", :orient \"right\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"bottom\", :ticks 0} {:scale \"x\", :type \"x\", :orient \"top\", :ticks 0}], :marks [{:type \"rect\", :from {:data \"95d67d4a-743f-44fc-9008-48578de38d3f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :x2 {:scale \"x\", :field \"data.x2\"}, :y {:scale \"y\", :field \"data.y\"}, :y2 {:scale \"y\", :field \"data.y2\"}, :fill {:value \"red\"}, :fillOpacity {:field \"data.opacity\"}}}} {:type \"text\", :from {:data \"95d67d4a-743f-44fc-9008-48578de38d3f\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :baseline {:value \"middle\"}, :align {:value \"center\"}, :fill {:value \"black\"}, :width {:value 29}, :dy {:value 15}, :x {:scale \"x\", :field \"data.x\", :offset 15}, :fontSize {:value 18.0}, :text {:field \"data.text\"}}}}], :data [{:name \"95d67d4a-743f-44fc-9008-48578de38d3f\", :values ({:x 4, :x2 5, :y 3, :y2 4, :text nil, :opacity 1} {:x 3, :x2 4, :y 4, :y2 5, :text nil, :opacity 1} {:x 2, :x2 3, :y 4, :y2 5, :text nil, :opacity 1} {:x 4, :x2 5, :y 4, :y2 5, :text nil, :opacity 1} {:x 3, :x2 4, :y 2, :y2 3, :text nil, :opacity 1})}], :width 180, :height 180}})"}
;; <=

;; **
;;; We're done!
;; **
